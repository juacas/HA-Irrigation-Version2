# lovelace_gen

#==========================
#=== Cycle Schedule Header
#==========================
type: horizontal-stack
cards:

  #=== Title and Weather Outlook
  - type: custom:button-card
    entity: sensor.weather_just_icon
    name: >
      [[[
        var entity_id = 'input_text.irrigation_cycle{{ cycle }}_name';
        return states[entity_id].state.toUpperCase() + ' SCHEDULE';
      ]]]
    # label: when Evaporation mode the values of the zone are relative durations
    show_label: true
    # return states['sensor.dark_sky_current_minutely_summary'] ? 'Weather Outlook: ' + states['sensor.dark_sky_current_minutely_summary'].state.replace(',', ',<br>') : 'DarkSky not configured correctly';
    size: 80%
    tap_action:
      action: call-service
      service: browser_mod.popup
      service_data:
        title: Cycle {{ cycle }} Settings
        card:
          type: entities
          entities:
            - entity: input_text.irrigation_cycle{{ cycle }}_name
              name: Name
              icon: mdi:alphabetical-variant
        deviceID:
          - this
        style:
          font-family: >
            [[[
              return states['input_text.irrigation_ui_font_family'].state
            ]]]
          font-size: 14px
          border-radius: 1em
          box-shadow: 0em 0em 0.5em
          opacity: 0.9
    styles:
      grid:
        - grid-template-areas: '"n n" "i l"'
        - grid-template-columns: min-content min-content  
        - grid-template-rows: 1fr min-content
      img_cell:
        - width: 2em
        - margin-left: -0.5em
      card:
        - border-radius: 0px
        - margin-left: 0.5em
        - padding: 0em
        - box-shadow: none
        - background: none
      name:
        - font-family: >
            [[[
              return states['input_text.irrigation_ui_font_family'].state
            ]]]
        - font-size: 18px
        - color: var(--secondary-text-color)
        - justify-self: start
        - border-left: 3px solid var(--accent-color)
        - padding-left: 0.5em
        - margin-bottom: 0.2em
      icon:
        - color: var(--secondary-text-color)
      label:
        - text-align: left
        - font-size: 12px
        - margin-top: 0.1em

  #=== Cycle Running Icon
  - type: custom:button-card
    icon: mdi:sprinkler-variant
    show_name: false
    entity: input_boolean.irrigation_cycle{{ cycle }}_running
    tap_action:
      action: none
    styles:
      card:
        - background: none
        - height: 45px
        - width: 45px
        - box-shadow: none
      icon:
        - width: 25px
    state:
      - value: 'off'
        color: var(--primary-background-color)
      - value: 'on'
        color: var(--paper-item-icon-active-color)
        styles:
          icon:
            - animation: blink 2s ease infinite

  #=== Cycle 1 and 2 Enable Schedule Button
  - type: custom:button-card
    icon: mdi:toggle-switch
    show_name: false
    entity: input_boolean.irrigation_cycle{{ cycle }}_schedule_enabled
    tap_action:
      action: toggle
    styles:
      card:
        - background: none
        - height: 45px
        - width: 45px
        - display: >
            [[[
              var cycle = '{{ cycle }}';
              if (cycle == '3') return 'none';
            ]]]
      icon:
        - width: 45px
    state:
      - value: 'off'
        icon: mdi:toggle-switch-off-outline
        styles:
          card:
            - color: var(--secondary-text-color)
            - opacity: 50%
            - box-shadow: none
          icon:
            - color: var(--secondary-text-color)
      - value: 'on'
        color: var(--paper-item-icon-active-color)
        icon: mdi:toggle-switch

  #=== Cycle 3 Start/Stop Button
  - type: custom:button-card
    entity: input_boolean.irrigation_cycle3_running
    icon: mdi:play-circle-outline
    show_name: false
    tap_action:
      action: >
        [[[
          if (states['input_boolean.irrigation_cycle1_running'].state == 'on' ||
              states['input_boolean.irrigation_cycle2_running'].state == 'on')
            return 'none';
          else if (states['input_boolean.irrigation_cycle3_running'].state == 'on')
            return 'call-service';
          else return 'toggle';
        ]]]
      service: script.irrigation_stop_irrigation
      service_data:
        cycle: cycle3
        zone: >
          [[[
            if (states['timer.irrigation_zone1_timer'].state == 'active')
              return 'zone1';
            else if (states['timer.irrigation_zone2_timer'].state == 'active')
              return 'zone2';
            else if (states['timer.irrigation_zone3_timer'].state == 'active')
              return 'zone3';
            else if (states['timer.irrigation_zone4_timer'].state == 'active')
              return 'zone4';
            else if (states['timer.irrigation_zone5_timer'].state == 'active')
              return 'zone5';
            else if (states['timer.irrigation_zone6_timer'].state == 'active')
              return 'zone6';
            else if (states['timer.irrigation_zone7_timer'].state == 'active')
              return 'zone7';
            else if (states['timer.irrigation_zone8_timer'].state == 'active')
              return 'zone8';
            else
              return 'none';
          ]]]
    styles:
      card:
        - background: none
        - height: 45px
        - width: 45px
        - box-shadow: none
        - display: >
            [[[
              var cycle = '{{ cycle }}';
              if (cycle != '3') return 'none';
            ]]]
      icon:
        - width: 35px
    state:
      - value: 'off'
        icon: mdi:play-circle-outline
        color: green
      - value: 'on'
        icon: mdi:stop-circle-outline
        color: red

